<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Quote Jar">
    <meta name="theme-color" content="#d4b896">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üí¨</text></svg>">
    <title>Quote Jar - Funny Quotes Collection</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400;1,600&family=Lora:ital,wght@0,400;0,600;1,400;1,600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lora', serif;
            background: #e8d5c4;
            min-height: 100vh;
            padding: 40px 20px;
            color: #5c4033;
            position: relative;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .sync-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            box-shadow: 0 2px 8px rgba(92, 64, 51, 0.1);
            border: 1px solid #d4b896;
            z-index: 1000;
            color: #8b6f47;
            font-style: italic;
        }

        .sync-status.syncing {
            border-color: #c89f6f;
        }

        .sync-status.synced {
            border-color: #9b8b6f;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
        }

        h1 {
            color: #8b5a3c;
            font-size: 2.5em;
            margin-bottom: 15px;
            font-weight: 400;
            font-style: italic;
            letter-spacing: 1px;
        }

        .subtitle {
            color: #a67c52;
            font-size: 1.1em;
            font-style: italic;
            margin-bottom: 30px;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-top: 25px;
            justify-content: center;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.6);
            padding: 20px 30px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid #d4b896;
        }

        .stat-number {
            font-size: 2em;
            font-weight: 600;
            color: #8b5a3c;
        }

        .stat-label {
            font-size: 0.9em;
            color: #a67c52;
            font-style: italic;
            margin-top: 5px;
        }

        .input-section {
            background: rgba(255, 255, 255, 0.7);
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 40px;
            box-shadow: 0 4px 15px rgba(92, 64, 51, 0.08);
            border: 1px solid #d4b896;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            color: #8b5a3c;
            font-weight: 600;
            font-size: 1.05em;
            font-style: italic;
        }

        input, textarea {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid #d4b896;
            border-radius: 12px;
            font-family: 'Lora', serif;
            font-size: 1.05em;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s;
            color: #5c4033;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #a67c52;
            background: white;
            box-shadow: 0 2px 8px rgba(92, 64, 51, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
            font-style: italic;
        }

        .save-btn {
            background: #a67c52;
            color: #fff9f0;
            padding: 14px 35px;
            border: none;
            border-radius: 25px;
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Lora', serif;
            width: 100%;
            box-shadow: 0 3px 10px rgba(166, 124, 82, 0.2);
            font-style: italic;
        }

        .save-btn:hover {
            background: #8b5a3c;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 90, 60, 0.3);
        }

        .save-btn:active {
            transform: translateY(0);
        }

        .filter-section {
            background: rgba(255, 255, 255, 0.7);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 40px;
            box-shadow: 0 4px 15px rgba(92, 64, 51, 0.08);
            border: 1px solid #d4b896;
        }

        .filter-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .filter-btn {
            background: rgba(255, 255, 255, 0.8);
            color: #8b5a3c;
            padding: 10px 24px;
            border: 1px solid #d4b896;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Lora', serif;
            font-weight: 400;
            font-style: italic;
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(92, 64, 51, 0.1);
        }

        .filter-btn.active {
            background: #a67c52;
            color: #fff9f0;
            border-color: #a67c52;
        }

        .person-filter {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .person-chip {
            background: rgba(255, 255, 255, 0.8);
            padding: 8px 18px;
            border-radius: 20px;
            border: 1px solid #d4b896;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95em;
            color: #8b5a3c;
            font-style: italic;
        }

        .person-chip:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
        }

        .person-chip.active {
            background: #8b5a3c;
            color: #fff9f0;
            border-color: #8b5a3c;
        }

        .quotes-section {
            background: rgba(255, 255, 255, 0.7);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(92, 64, 51, 0.08);
            border: 1px solid #d4b896;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .section-header h2 {
            color: #8b5a3c;
            font-size: 1.8em;
            font-weight: 400;
            font-style: italic;
        }

        .random-btn {
            background: rgba(200, 159, 111, 0.3);
            color: #8b5a3c;
            padding: 10px 20px;
            border: 1px solid #c89f6f;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Lora', serif;
            font-weight: 400;
            transition: all 0.3s;
            font-style: italic;
        }

        .random-btn:hover {
            background: rgba(200, 159, 111, 0.5);
            transform: scale(1.05);
        }

        .quote-item {
            background: rgba(255, 249, 240, 0.9);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 3px solid #a67c52;
            position: relative;
            transition: all 0.3s;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .quote-item:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 12px rgba(92, 64, 51, 0.12);
        }

        .quote-text {
            font-family: 'Crimson Text', serif;
            font-size: 1.2em;
            color: #5c4033;
            margin-bottom: 15px;
            line-height: 1.6;
            font-style: italic;
        }

        .quote-text::before {
            content: '"';
            font-size: 1.5em;
            color: #a67c52;
            margin-right: 5px;
        }

        .quote-text::after {
            content: '"';
            font-size: 1.5em;
            color: #a67c52;
            margin-left: 5px;
        }

        .quote-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95em;
        }

        .quote-person {
            color: #8b5a3c;
            font-weight: 600;
            font-style: italic;
        }

        .quote-person::before {
            content: '‚Äî ';
        }

        .quote-date {
            color: #a67c52;
            font-size: 0.9em;
            font-style: italic;
        }

        .quote-delete {
            position: absolute;
            top: 12px;
            right: 12px;
            background: none;
            border: none;
            color: #a67c52;
            cursor: pointer;
            font-size: 1.5em;
            opacity: 0;
            transition: opacity 0.3s;
            line-height: 1;
        }

        .quote-item:hover .quote-delete {
            opacity: 1;
        }

        .quote-delete:hover {
            color: #8b5a3c;
            transform: scale(1.2);
        }

        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #a67c52;
            font-style: italic;
            font-size: 1.1em;
        }

        .clear-btn {
            background: rgba(139, 90, 60, 0.2);
            color: #8b5a3c;
            padding: 10px 20px;
            border: 1px solid #a67c52;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 25px;
            font-family: 'Lora', serif;
            font-weight: 400;
            transition: all 0.3s;
            font-style: italic;
        }

        .clear-btn:hover {
            background: rgba(139, 90, 60, 0.3);
            transform: scale(1.05);
        }

        .success {
            animation: success 0.5s ease-out;
        }

        @keyframes success {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        * {
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        input, textarea {
            -webkit-user-select: text;
            user-select: text;
        }

        button {
            -webkit-tap-highlight-color: transparent;
        }

        @supports(padding: max(0px)) {
            body {
                padding-left: max(20px, env(safe-area-inset-left));
                padding-right: max(20px, env(safe-area-inset-right));
                padding-bottom: max(20px, env(safe-area-inset-bottom));
                padding-top: max(40px, env(safe-area-inset-top));
            }
        }

        @media (max-width: 600px) {
            .input-section, .quotes-section, .filter-section {
                padding: 25px;
            }

            h1 {
                font-size: 2em;
            }

            .section-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="sync-status" id="syncStatus">‚òÅÔ∏è offline</div>

    <div class="container">
        <div class="header">
            <h1>üß° quote jar üß°</h1>
            <p class="subtitle">collection of funny things people say</p>
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-number" id="totalQuotes">0</div>
                    <div class="stat-label">quotes saved</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="totalPeople">0</div>
                    <div class="stat-label">hilarious people</div>
                </div>
            </div>
        </div>

        <div class="input-section">
            <div class="input-group">
                <label for="quoteInput">üí≠ the quote</label>
                <textarea 
                    id="quoteInput" 
                    placeholder="what hilarious thing did they say?"
                    maxlength="500"
                ></textarea>
            </div>
            <div class="input-group">
                <label for="personInput">üë§ who said it</label>
                <input 
                    type="text" 
                    id="personInput" 
                    placeholder="name or nickname"
                    maxlength="50"
                    list="personSuggestions"
                >
                <datalist id="personSuggestions"></datalist>
            </div>
            <button id="saveBtn" class="save-btn">save quote üí¨</button>
        </div>

        <div class="filter-section">
            <div class="filter-buttons">
                <button class="filter-btn active" data-sort="recent">most recent</button>
                <button class="filter-btn" data-sort="oldest">oldest first</button>
                <button class="filter-btn" data-sort="person">by person (a-z)</button>
            </div>
            <div id="personFilters" class="person-filter"></div>
        </div>

        <div class="quotes-section">
            <div class="section-header">
                <h2>your quote collection</h2>
                <button class="random-btn" id="randomBtn">random quote</button>
            </div>
            <div id="quotesList"></div>
            <button class="clear-btn" id="clearBtn">clear all quotes</button>
        </div>
    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDbSLq5r_pfjBVtRU9YUDjqsXdI5MKtcUA",
            authDomain: "quote-jar-807cf.firebaseapp.com",
            projectId: "quote-jar-807cf",
            storageBucket: "quote-jar-807cf.firebasestorage.app",
            messagingSenderId: "538760827455",
            appId: "1:538760827455:web:3fc6d7b778b1aaf46b9e8a"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let currentUser = null;
        let quotesListener = null;
        let currentFilter = 'recent';
        let selectedPerson = null;

        // Update sync status
        function updateSyncStatus(status, message) {
            const statusEl = document.getElementById('syncStatus');
            statusEl.className = 'sync-status ' + status;
            statusEl.textContent = message;
        }

        // Sign in anonymously
        signInAnonymously(auth).catch(error => {
            console.error('Auth error:', error);
            updateSyncStatus('', '‚òÅÔ∏è offline mode');
        });

        // Listen for auth changes
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                updateSyncStatus('synced', '‚òÅÔ∏è synced');
                loadQuotesFromFirebase();
            } else {
                currentUser = null;
                updateSyncStatus('', '‚òÅÔ∏è offline');
            }
        });

        // Load quotes from Firebase
        function loadQuotesFromFirebase() {
            if (!currentUser) return;

            const quotesRef = collection(db, 'users', currentUser.uid, 'quotes');
            const q = query(quotesRef, orderBy('date', 'desc'));

            quotesListener = onSnapshot(q, (snapshot) => {
                const quotes = [];
                snapshot.forEach((doc) => {
                    quotes.push({
                        ...doc.data(),
                        id: doc.id
                    });
                });
                
                // Store in localStorage as backup
                localStorage.setItem('funnyQuotes', JSON.stringify(quotes));
                
                updateStats();
                updatePersonFilters();
                updatePersonSuggestions();
                displayQuotes();
                updateSyncStatus('synced', '‚òÅÔ∏è synced');
            }, (error) => {
                console.error('Sync error:', error);
                updateSyncStatus('', '‚òÅÔ∏è offline');
            });
        }

        // Save quote to Firebase
        async function saveQuoteToFirebase(quote) {
            if (!currentUser) {
                alert('not connected to cloud. quote saved locally.');
                return;
            }

            try {
                updateSyncStatus('syncing', '‚òÅÔ∏è syncing...');
                const quotesRef = collection(db, 'users', currentUser.uid, 'quotes');
                await addDoc(quotesRef, {
                    text: quote.text,
                    person: quote.person,
                    date: quote.date
                });
            } catch (error) {
                console.error('Error saving:', error);
                updateSyncStatus('', '‚òÅÔ∏è offline');
            }
        }

        // Delete quote from Firebase
        async function deleteQuoteFromFirebase(id) {
            if (!currentUser) return;

            try {
                updateSyncStatus('syncing', '‚òÅÔ∏è syncing...');
                await deleteDoc(doc(db, 'users', currentUser.uid, 'quotes', id));
            } catch (error) {
                console.error('Error deleting:', error);
                updateSyncStatus('', '‚òÅÔ∏è offline');
            }
        }

        // Update stats
        function updateStats() {
            const quotes = JSON.parse(localStorage.getItem('funnyQuotes')) || [];
            document.getElementById('totalQuotes').textContent = quotes.length;
            
            const uniquePeople = [...new Set(quotes.map(q => q.person))];
            document.getElementById('totalPeople').textContent = uniquePeople.length;
        }

        // Get unique people
        function getUniquePeople() {
            const quotes = JSON.parse(localStorage.getItem('funnyQuotes')) || [];
            return [...new Set(quotes.map(q => q.person))].sort();
        }

        // Update person filters
        function updatePersonFilters() {
            const people = getUniquePeople();
            const container = document.getElementById('personFilters');
            
            if (people.length === 0) {
                container.innerHTML = '<p style="color: #a67c52; font-size: 0.95em; font-style: italic;">no quotes yet! add your first one above</p>';
                return;
            }

            container.innerHTML = people.map(person => 
                `<div class="person-chip ${selectedPerson === person ? 'active' : ''}" 
                      onclick="window.filterByPerson('${person.replace(/'/g, "\\'")}')">
                    ${person}
                </div>`
            ).join('');
        }

        // Update person suggestions
        function updatePersonSuggestions() {
            const people = getUniquePeople();
            const datalist = document.getElementById('personSuggestions');
            datalist.innerHTML = people.map(person => 
                `<option value="${person}">`
            ).join('');
        }

        // Filter by person
        window.filterByPerson = function(person) {
            if (selectedPerson === person) {
                selectedPerson = null;
            } else {
                selectedPerson = person;
            }
            updatePersonFilters();
            displayQuotes();
        }

        // Save quote
        window.saveQuote = function() {
            const quoteInput = document.getElementById('quoteInput');
            const personInput = document.getElementById('personInput');
            
            const quoteText = quoteInput.value.trim();
            const person = personInput.value.trim();
            
            if (!quoteText || !person) {
                alert('please fill in both the quote and who said it!');
                return;
            }

            const quote = {
                text: quoteText,
                person: person,
                date: new Date().toISOString()
            };

            // Save to Firebase (will auto-update localStorage via listener)
            saveQuoteToFirebase(quote);

            // Clear inputs
            quoteInput.value = '';
            personInput.value = '';

            // Success feedback
            const btn = document.getElementById('saveBtn');
            btn.textContent = 'quote saved! üéâ';
            btn.style.background = '#9b8b6f';
            btn.classList.add('success');

            setTimeout(() => {
                btn.textContent = 'save quote üí¨';
                btn.style.background = '';
                btn.classList.remove('success');
            }, 2000);
        }

        // Display quotes
        function displayQuotes() {
            let quotes = JSON.parse(localStorage.getItem('funnyQuotes')) || [];
            const container = document.getElementById('quotesList');

            if (selectedPerson) {
                quotes = quotes.filter(q => q.person === selectedPerson);
            }

            if (currentFilter === 'recent') {
                quotes.sort((a, b) => new Date(b.date) - new Date(a.date));
            } else if (currentFilter === 'oldest') {
                quotes.sort((a, b) => new Date(a.date) - new Date(b.date));
            } else if (currentFilter === 'person') {
                quotes.sort((a, b) => a.person.localeCompare(b.person));
            }

            if (quotes.length === 0) {
                container.innerHTML = '<div class="empty-state">no quotes yet. start collecting hilarious moments above!</div>';
                return;
            }

            container.innerHTML = quotes.map(quote => {
                const date = new Date(quote.date);
                const dateStr = date.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: date.getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined
                });

                return `
                    <div class="quote-item">
                        <button class="quote-delete" onclick="window.deleteQuote('${quote.id}')" title="Delete">√ó</button>
                        <div class="quote-text">${quote.text}</div>
                        <div class="quote-meta">
                            <span class="quote-person">${quote.person}</span>
                            <span class="quote-date">${dateStr}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Delete quote
        window.deleteQuote = function(id) {
            if (confirm('delete this quote?')) {
                deleteQuoteFromFirebase(id);
            }
        }

        // Clear all quotes
        window.clearAll = function() {
            if (confirm('delete all quotes? this cannot be undone!')) {
                if (!currentUser) {
                    localStorage.removeItem('funnyQuotes');
                    selectedPerson = null;
                    updateStats();
                    updatePersonFilters();
                    updatePersonSuggestions();
                    displayQuotes();
                    return;
                }

                const quotes = JSON.parse(localStorage.getItem('funnyQuotes')) || [];
                quotes.forEach(quote => {
                    deleteQuoteFromFirebase(quote.id);
                });
            }
        }

        // Show random quote
        window.showRandomQuote = function() {
            const quotes = JSON.parse(localStorage.getItem('funnyQuotes')) || [];
            if (quotes.length === 0) {
                alert('no quotes yet! add some first!');
                return;
            }

            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            alert(`"${randomQuote.text}"\n\n‚Äî ${randomQuote.person}`);
        }

        // Sort button handlers
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentFilter = this.dataset.sort;
                displayQuotes();
            });
        });

        // Event listeners
        document.getElementById('saveBtn').addEventListener('click', window.saveQuote);
        document.getElementById('quoteInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && e.ctrlKey) window.saveQuote();
        });
        document.getElementById('clearBtn').addEventListener('click', window.clearAll);
        document.getElementById('randomBtn').addEventListener('click', window.showRandomQuote);

        // Initialize on page load
        updateStats();
        updatePersonFilters();
        updatePersonSuggestions();
        displayQuotes();
    </script>
</body>
</html>